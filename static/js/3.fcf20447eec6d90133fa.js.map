{"version":3,"sources":["webpack:///src/view/ask/form/imgUpLoad.vue","webpack:///./src/view/ask/form/imgUpLoad.vue?b844","webpack:///./src/view/ask/form/imgUpLoad.vue"],"names":["imgUpLoad","data","imgList","file","fileList","imgurl","img64","created","methods","addImgH","e","imgPath","document","getElementById","imgInfo","name","files","size","type","src","this","getObjectURL","push","console","log","value","compression","addImg","click","upload","formdata","_this","Object","http","then","res","file_path","$emit","catch","err","mint_ui_common","message","position","duration","splice","del","index","parseInt","url","undefined","window","createObjectURL","URL","webkitURL","compress","img","width","height","ratio","canvas","createElement","getContext","drawImage","toDataURL","image","Image","last","length","setAttribute","that","onload","imgH","imgW","showSize","bytes","atob","split","array","i","charCodeAt","blob","Blob","Uint8Array","fd","FormData","append","Date","now","base64url","str","replace","equalIndex","indexOf","substring","strLength","fileLength","toFixed","parseFloat","show","k","form_imgUpLoad","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","id","directives","rawName","movable","expression","images","_l","v","key","on","$event","_v","alt","title","_e","ref","accept","change","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"wJAuBAA,GACAC,KADA,WAEA,OACAC,WACAC,KAAA,GACAC,YACAC,OAAA,GACAC,MAAA,KAGAC,QAVA,aA8BAC,SACAC,QADA,SACAC,GACA,IAAAC,EAAAC,SAAAC,eAAA,UACAC,KACAC,EAAAJ,EAAAK,MAAA,GAAAD,KACAE,EAAAN,EAAAK,MAAA,GAAAC,KACAC,EAAAP,EAAAK,MAAA,GAAAE,KACAC,EAAAC,KAAAC,aAAAV,EAAAK,MAAA,IACAF,EAAAC,OACAD,EAAAG,OACAH,EAAAI,OACAJ,EAAAK,MACAC,KAAAlB,QAAAoB,KAAAR,GACAM,KAAAjB,KAAAQ,EAAAK,MAAA,GACAO,QAAAC,IAAAb,EAAAK,OACAL,EAAAc,MAAA,GACAL,KAAAM,eAEAC,OAlBA,WAmBAf,SAAAC,eAAA,UACAe,SAEAC,OAtBA,SAsBAC,GAAA,IAAAC,EAAAX,KACAG,QAAAC,IAAAJ,KAAAjB,MAIA,IAAAF,EAAA6B,EACME,OAAAC,EAAA,EAAAD,CAAN/B,GACAiC,KAAA,SAAAC,GACAZ,QAAAC,IAAAW,GACAJ,EAAA3B,SAAAkB,KAAAa,GACAJ,EAAA1B,OAAA8B,EAAAC,UACAL,EAAAM,MAAA,cAAAN,EAAA3B,UACAmB,QAAAC,IAAAO,EAAA3B,YAEAkC,MAAA,SAAAC,GACQP,OAAAQ,EAAA,MAAAR,EACRS,QAAAF,EACAG,SAAA,SACAC,SAAA,MAEAZ,EAAA7B,QAAA0C,QAAA,QAGAC,IA7CA,SA6CAC,GACA1B,KAAAlB,QAAA0C,OAAAG,SAAAD,GAAA,GACA1B,KAAAhB,SAAAwC,OAAAG,SAAAD,GAAA,GACAvB,QAAAC,IAAAJ,KAAAhB,WAGAiB,aAnDA,SAmDAlB,GACA,IAAA6C,EAAA,KAQA,YAPAC,GAAAC,OAAAC,gBACAH,EAAAE,OAAAC,gBAAAhD,QACA8C,GAAAC,OAAAE,IACAJ,EAAAE,OAAAE,IAAAD,gBAAAhD,QACA8C,GAAAC,OAAAG,YACAL,EAAAE,OAAAG,UAAAF,gBAAAhD,IAEA6C,GAGAM,SA/DA,SA+DAC,EAAAC,EAAAC,EAAAC,GACA,IAAAC,EAWA,OATAA,EAAA/C,SAAAgD,cAAA,WACAJ,QACAG,EAAAF,SAEAE,EAAAE,WAAA,MACAC,UAAAP,EAAA,IAAAC,EAAAC,GAEAE,EAAAI,UAAA,aAAAL,IAIAhC,YA7EA,WA8EAd,SAAAC,eAAA,YACAmD,EAAA,IAAAC,MACAC,EAAA9C,KAAAlB,QAAAiE,OACAH,EAAA7C,IAAAC,KAAAlB,QAAAgE,EAAA,GAAA/C,IACA6C,EAAAI,aAAA,2BACA,IAAAC,EAAAjD,KACA4C,EAAAM,OAAA,WACA,IAAAC,EAAAnD,KAAAqC,OACAe,EAAApD,KAAAoC,MACAlD,EAAA+D,EAAAf,SAAAU,EAAAQ,EAAAD,EAAA,IACAF,EAAA/D,QACAiB,QAAAC,IAAA6C,EAAAI,SAAAnE,IAKA,IAFA,IAAAoE,EAAAxB,OAAAyB,KAAArE,EAAAsE,MAAA,SACAC,KACAC,EAAA,EAAAA,EAAAJ,EAAAP,OAAAW,IACAD,EAAAvD,KAAAoD,EAAAK,WAAAD,IAEA,IAAAE,EAAA,IAAAC,MAAA,IAAAC,WAAAL,KAAA3D,KAAA,eACAiE,EAAA,IAAAC,SACAD,EAAAE,OAAA,OAAAL,EAAAM,KAAAC,MAAA,QACAlB,EAAAxC,OAAAsD,KAIAV,SAxGA,SAwGAe,GAEA,IAAAC,EAAAD,EAAAE,QAAA,8BACAC,EAAAF,EAAAG,QAAA,KACAH,EAAAG,QAAA,SACAH,IAAAI,UAAA,EAAAF,IAEA,IAAAG,EAAAL,EAAAtB,OACA4B,EAAAhD,SAAA+C,IAAA,KACAvE,QAAAC,IAAAuE,GAEA,IAAA9E,EAGA,OAFAA,GAAA8E,EAAA,SAAAC,QAAA,GACAzE,QAAAC,IAAAP,GACAgF,WAAAhF,IAEAiF,KAxHA,SAwHAC,OC1KeC,GADEC,OAFjB,WAA0B,IAAAC,EAAAlF,KAAamF,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,SAAAC,OAA4BC,GAAA,UAAa,GAAAP,EAAAlG,SAAA+D,OAAAsC,EAAA,MAAqCK,aAAa/F,KAAA,SAAAgG,QAAA,WAAAtF,OAAyCuF,SAAA,GAAeC,WAAA,qBAAgCN,YAAA,UAAAC,OAA+BM,OAAAZ,EAAApG,UAAsBoG,EAAAa,GAAAb,EAAA,iBAAAc,EAAAjB,GAAoC,OAAAM,EAAA,MAAgBY,IAAAlB,IAAMM,EAAA,OAAYE,YAAA,MAAAW,IAAsB1F,MAAA,SAAA2F,GAAyBjB,EAAAzD,IAAAsD,OAAaG,EAAAkB,GAAA,KAAAf,EAAA,OAAwBE,YAAA,SAAAC,OAA4BzF,IAAAiG,EAAAjG,IAAAsG,IAAA,GAAAC,MAAAN,EAAArG,KAAA,IAAAoF,GAA0CmB,IAAK1F,MAAA,SAAA2F,GAAyBjB,EAAAJ,KAAAC,YAAkBG,EAAAqB,KAAArB,EAAAkB,GAAA,KAAAf,EAAA,SAAoCmB,IAAA,cAAAhB,OAAyB1F,KAAA,OAAA2F,GAAA,SAAAgB,OAAA,kCAAsEP,IAAKQ,OAAA,SAAAP,GAA0BjB,EAAA7F,cAAgB6F,EAAAkB,GAAA,KAAAf,EAAA,aAA8BG,OAAO1F,KAAA,WAAiBoG,IAAK1F,MAAA0E,EAAA3E,UAAoB2E,EAAAkB,GAAA,eAEl1BO,oBCEjB,IAcAC,EAdyBC,EAAQ,OAcjCC,CACElI,EACAoG,GATF,EAXA,SAAA+B,GACEF,EAAQ,QACRA,EAAQ,SAaV,kBAEA,MAUeG,EAAA,QAAAJ,EAAiB","file":"static/js/3.fcf20447eec6d90133fa.js","sourcesContent":["<template>\r\n  <div class=\"upload\" id='main'>\r\n    <ul :images=\"imgList\" v-if=\"fileList.length !=0\" class=\"imgList\" v-viewer='{movable: false}'>\r\n      <li v-for=\"(v,k) in imgList\" :key=\"k\">\r\n        <div class=\"del\" @click=\"del(k)\">\r\n          <!-- <img src=\"@/assets/images/del.png\" alt=\"\"> -->\r\n        </div>\r\n        <img :src=\"v.src\" alt=\"\" :title=\"v.name+','+k\" @click=\"show(k)\" class=\"images\">\r\n      </li>\r\n      <!-- <li>\r\n        <img src=\"@/assets/images/upload_photo.png\" alt=\"\" @click=\"addImg\">\r\n      </li> -->\r\n    </ul>\r\n    <input type=\"file\" id=\"upload\" @change=\"addImgH()\" accept=\"image/png,image/gif,image/jpeg\" ref=\"avatarInput\">\r\n     <mt-button type=\"primary\" @click=\"addImg\">上传图片</mt-button>\r\n     <!-- <mt-button type=\"primary\" @click=\"compression\">测试按钮</mt-button> -->\r\n     <!-- <img :src=\"img64\" alt=\"\"> -->\r\n  </div>\r\n</template>   \r\n\r\n<script>\r\n  import { upload } from '@/api/http'\r\n  import { Toast } from 'mint-ui';\r\n  export default {\r\n    data(){\r\n      return {\r\n        imgList:[],\r\n        file:'',\r\n        fileList:[],\r\n        imgurl:'',\r\n        img64:'',\r\n      }\r\n    },\r\n    created(){\r\n      // new Viewer(image, {\r\n      //   toolbar: {\r\n      //     zoomIn: 4,\r\n      //     zoomOut: 4,\r\n      //     oneToOne: 4,\r\n      //     reset: 4,\r\n      //     prev: 4,\r\n      //     play: {\r\n      //       show: 4,\r\n      //       size: 'large',\r\n      //     },\r\n      //     next: 4,\r\n      //     rotateLeft: 4,\r\n      //     rotateRight: 4,\r\n      //     flipHorizontal: 4,\r\n      //     flipVertical: 4,\r\n      //   },\r\n      // });\r\n    },\r\n    methods:{\r\n      addImgH(e){\r\n        let imgPath = document.getElementById('upload')\r\n        let imgInfo = {}\r\n        let name = imgPath.files[0].name\r\n        let size = imgPath.files[0].size\r\n        let type = imgPath.files[0].type\r\n        let src = this.getObjectURL(imgPath.files[0])\r\n        imgInfo.name = name\r\n        imgInfo.size = size\r\n        imgInfo.type = type\r\n        imgInfo.src = src\r\n        this.imgList.push(imgInfo)\r\n        this.file = imgPath.files[0]\r\n        console.log(imgPath.files)\r\n        imgPath.value = ''\r\n        this.compression()\r\n      },\r\n      addImg(){\r\n        let imgPath = document.getElementById('upload')\r\n        imgPath.click()\r\n      },\r\n      upload(formdata){\r\n        console.log(this.file)\r\n        // let file = new FormData()\r\n        // file.append(\"file\",this.file)\r\n        // console.log(file.get(\"file\"))\r\n        const data = formdata\r\n        upload(data)\r\n        .then((res)=>{\r\n          console.log(res)\r\n          this.fileList.push(res)\r\n          this.imgurl = res.file_path\r\n          this.$emit('getfilelist', this.fileList)\r\n          console.log(this.fileList)\r\n        })\r\n        .catch((err)=>{\r\n          Toast({\r\n            message: err,\r\n            position: 'bottom',\r\n            duration: 5000\r\n          });\r\n          this.imgList.splice(-1,1)\r\n        })\r\n      },\r\n      del(index){\r\n        this.imgList.splice(parseInt(index),1)\r\n        this.fileList.splice(parseInt(index),1)\r\n        console.log(this.fileList)\r\n      },\r\n      // 获取图片预览\r\n      getObjectURL(file) {  \r\n\t      var url = null ;   \r\n\t      if (window.createObjectURL!=undefined) {  \r\n\t        url = window.createObjectURL(file) ;  \r\n\t      } else if (window.URL!=undefined) {   \r\n\t        url = window.URL.createObjectURL(file) ;  \r\n\t      } else if (window.webkitURL!=undefined) {  \r\n\t        url = window.webkitURL.createObjectURL(file) ;  \r\n\t      }  \r\n\t      return url ;  \r\n      },\r\n      // 图片压缩\r\n      compress(img, width, height, ratio) { // img可以是dataURL或者图片url\r\n        var canvas, ctx, img64;\r\n\r\n        canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        ctx = canvas.getContext(\"2d\");\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n\r\n        img64 = canvas.toDataURL(\"image/jpeg\", ratio);\r\n\r\n        return img64; // 压缩后的base64串\r\n      },\r\n      compression(){\r\n        let imgPath = document.getElementById('main')\r\n        var image = new Image();\r\n        let last = this.imgList.length\r\n        image.src = this.imgList[last-1].src\r\n        image.setAttribute(\"crossOrigin\",'Anonymous')\r\n        let that = this\r\n        image.onload = function(){\r\n          let imgH = this.height\r\n          let imgW = this.width\r\n          let img64 = that.compress(image, imgW, imgH, 0.3);\r\n          that.img64 = img64\r\n          console.log(that.showSize(img64))\r\n          // console.log(that.image64)\r\n          // base64转FormData\r\n          let bytes = window.atob(img64.split(',')[1])\r\n          let array=[]\r\n          for (let i = 0; i < bytes.length; i++){\r\n            array.push(bytes.charCodeAt(i))\r\n          }\r\n          let blob = new Blob([new Uint8Array(array)],{type: 'image/jpeg'})\r\n          let fd = new FormData()\r\n          fd.append('file',blob,Date.now()+'.jpg')\r\n          that.upload(fd);\r\n          // return img64\r\n        }\r\n      },\r\n      showSize(base64url){\r\n        //获取base64图片大小，返回MB数字\r\n        var str = base64url.replace('data:image/jpeg;base64,', '');\r\n        var equalIndex = str.indexOf('=');\r\n        if(str.indexOf('=')>0) {\r\n            str=str.substring(0, equalIndex);\r\n        }\r\n        var strLength=str.length;\r\n        var fileLength=parseInt(strLength-(strLength/8)*2);\r\n        console.log(fileLength)\r\n        // 由字节转换为MB\r\n        var size = \"\";\r\n        size = (fileLength/(1024 * 1024)).toFixed(2);\r\n        console.log(size)\r\n        return parseFloat(size);\r\n      },\r\n      show(k){\r\n        // const viewer = this.$el.querySelector('.images')[k].$viewer\r\n        // viewer.show()\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .upload{\r\n    padding: 10px;\r\n    font-size: 16px;\r\n  }\r\n  #upload{\r\n    display: none\r\n  }\r\n  .imgList{\r\n    border: 1px #ddd solid;\r\n    padding: 5px;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    margin-bottom: 20px;\r\n  }\r\n  li{\r\n    position: relative;\r\n    width: 21%;\r\n    margin: 0 2%;\r\n    font-size: 0;\r\n  }\r\n\r\n  .imgList>li>.del{\r\n    position: absolute;\r\n    width: 20px;\r\n    height: 20px;\r\n    background-image: url('../../../assets/images/del.png');\r\n    background-size: cover;\r\n    right: 0;\r\n    top: 3px;\r\n  }\r\n  \r\n  \r\n</style>\r\n\r\n<style>\r\n.viewer-zoom-in::before, .viewer-zoom-out::before, .viewer-one-to-one::before, .viewer-reset::before, .viewer-prev::before, .viewer-play::before, .viewer-next::before, .viewer-rotate-left::before, .viewer-rotate-right::before, .viewer-flip-horizontal::before, .viewer-flip-vertical::before, .viewer-fullscreen::before, .viewer-fullscreen-exit::before, .viewer-close::before{\r\n    background-size: cover !important;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/view/ask/form/imgUpLoad.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"upload\",attrs:{\"id\":\"main\"}},[(_vm.fileList.length !=0)?_c('ul',{directives:[{name:\"viewer\",rawName:\"v-viewer\",value:({movable: false}),expression:\"{movable: false}\"}],staticClass:\"imgList\",attrs:{\"images\":_vm.imgList}},_vm._l((_vm.imgList),function(v,k){return _c('li',{key:k},[_c('div',{staticClass:\"del\",on:{\"click\":function($event){_vm.del(k)}}}),_vm._v(\" \"),_c('img',{staticClass:\"images\",attrs:{\"src\":v.src,\"alt\":\"\",\"title\":v.name+','+k},on:{\"click\":function($event){_vm.show(k)}}})])})):_vm._e(),_vm._v(\" \"),_c('input',{ref:\"avatarInput\",attrs:{\"type\":\"file\",\"id\":\"upload\",\"accept\":\"image/png,image/gif,image/jpeg\"},on:{\"change\":function($event){_vm.addImgH()}}}),_vm._v(\" \"),_c('mt-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.addImg}},[_vm._v(\"上传图片\")])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0537f8a8\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/view/ask/form/imgUpLoad.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0537f8a8\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./imgUpLoad.vue\")\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0537f8a8\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=1!./imgUpLoad.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./imgUpLoad.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./imgUpLoad.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0537f8a8\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./imgUpLoad.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-0537f8a8\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/view/ask/form/imgUpLoad.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}